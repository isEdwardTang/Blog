---
layout: post
title: "js的踩过的一些坑"
categories: JavaScript
tags:  bug JavaScript
author: Edward
---

* content
{:toc}

没怎么学过js的人就是可悲，这段时间写了一个稍微灵活的动态页面，让自己感受到js的博大精深和自己面对问题的手足无措！！！自己也踩了一些那么幼稚的坑！！！





## 一、判断字符串的那些坑

在java中深受字符串比较的迫害，到了js中发现还是个坑，因为js中不仅有null，还有undefined的存在，这里总结几种情况：

判断字符串是否为空串：

```js
if (strings.replace(/(^s*)|(s*$)/g, "").length == 0) {
    ...
}
```

判断是否为null：

```js
if (exp == null) {
    ...
}
```

判断是否为null或undefined：

```js
if (!exp) {
    ...
}
// null和undefined会得到相同的结果，所有下面的做法是多此一举
if (exp == null || exp == undefined) {
    ...
}
```

判断是null、undefined、数字零或false：

```js
if (typeof exp == "null") {
    ...
}
```

## 二、关于下拉框

设置下拉框的选中，直接用jQuery的$().val(value)设置即可，多选怎么办呢，传一个数组进来就好，不要傻傻的遍历option添加属性selected了！

获得下拉框的值，也直接使用val()即可

参考这篇博客获取详细信息：[Jquery获取select,dropdownlist,checkbox下拉列表框的值](http://www.cnblogs.com/shengxiang/archive/2011/09/06/2168557.html)


注意下拉框没有点击事件，使用change事件

## 三、this

使用匿名函数时，this是什么？只是控件而已，如果要用jQuery，还是得用$(this)包装成一个jQuery对象

## 四、关于表单的提交

表单提交这块算是深深被迫害了，一般和spring结合一起用时，直接使用spring的标签，通过path绑定bean的相应属性就好，可偏偏有时候不能使用form:标签，比如在动态添加表单控件时，这时候怎么办呢？那我们还是回归原始方法吧，使用name来提交表单，使用value结合EL表达式来获取bean的值就好。但是如果这个属性是个list怎么办呢？直接引用不就好了，可是有时候list的长度不确定怎么办？于是就有了这种奇葩的写法：

```js
function addCaseDiv(index, id, name) {
		
    var cdiv = ""
        + "<div class='col-sm-12' id='case" + index + "' >"
        + "<input type='button' class='col-sm-1 delBtn1' onclick='deleteCase(" + index + ")' />"
        + "<input type='hidden' name='list[" + index + "].id' value='" + id + "' />"
        + "<div class='col-sm-3'>"
        + "<div class='form-group'>"
        + "<label class='col-sm-5 control-label' >名称：</label>"     
        + "<div class='col-sm-5'>"  
        + "<select id='name" + index + "' name='list[" + index + "].name' class='form-control' onchange='getDim(" + index + ")'>"	      			
        ...		  
        + "</select>"   
        + "</div></div></div>"	
        ...
        + "</div></div></div></div>"; 	
        
    // 添加div
    $("#caseDiv").append(cdiv);
    ...
```

一堆的index，着实恐怖，如果要绑定事件的话，动态绑定是做不了了，最简单的方式是把index作为参数传过去了。

## 五、关于ajax异步调用

什么是异步，就是你知道它什么时候开始，却不知道他什么时候结束，如果非得等到异步调用结束后才执行怎么办，有两种方式：

在调用成功的函数中完成：

```js
$.ajax({ 
    ...
    success : function(data) {
        code block
    }
});
```

可是这匿名函数传不了参数啊，有人说把参数从服务器上过一遍不就得了，不过我实在懒，不想这么麻烦，直接让它歇了会：

```js
$.ajax(...);

setTimeout(function() {
    code block
}, 500);
```

## 六、在js中使用jsp代码

现阶段，还是个刚步入工作的菜鸟，经常写的就是一些增删改查的代码，而新增和修改，往往是相通的，我们一般把他们用一个jsp页面处理，只不过条件和参数不一样而已，可是有时候，在涉及页面有一些动态变化的时候，要想同时兼顾新增和修改真的很难，就不得不采用一些极端方法，比如在js中使用jsp代码如EL表达式，这时候需要注意，jsp的代码块首先被编译成class文件再转化为html的，所以，以下这种做法是不对的：

```js
var names = ${list};
```

这里右侧是个list，如果为空的话，F12你会看到这样一个错误：

```js
var names = ;
```

正确写法：

```js
var names = new Array();
<c:forEach items="${list}" var="name">
    names.push(name);
</c:forEach>
```

## 七、折中处理的思维

今天写代码时遇到这样一个问题，要求在某种情况下，下拉框只能选某个值，然后我就直接让这个情况下下拉框的val()设置为该值，再设置disabled属性就好，结果发现提交表单的时候值始终传不过去，现在还没找到原因，于是我换了一种思路，直接把其他的option remove掉，结果发现成了，所以有时候还是要圆滑一点！
